#!/usr/bin/env bash

op=$1
path=$2

case $path in
  *.tex|*.c|*.cc)
    fullname=$(bazel query $path)
    rule=$(bazel query "attr('srcs', $fullname, ${fullname//:*/}:*)")

    bazel $op $rule
    for dep in $(bazel query "kind('generated file', rdeps(..., $rule))"); do
      bazel $op $dep
    done
    ;;
  *)
    echo "error: unsupported file ($path)"
    ;;
esac
