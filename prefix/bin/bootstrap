#!/usr/bin/env bash

# This script bootstraps student repositories with a private fork of the public assignment
# repository. This script should be run by the instructor and not the students.
#
# TODO: perhaps avoid the clone altogether and run this from the repository directory itself to
# bootstrap a student repository
#
# NOTE: with the move to GitHub classroom, not sure if this script is even necessary anymore

source ~/prefix/lib/utilities.sh

function usage() {
    echo "usage: $0 repo username

    Positional arguments:
        repo                The repository name to bootstrap
        username            The student's github username

    Example:
        $ bash $0 cs404.1 fsareshwala
"
}

ensure_exists git

if [[ $# -ne 2 ]]; then
    usage
    exit
fi

repo=$1
username=$2

tmpdir=$(mktemp -d)
trap "rm -rf $tmpdir" EXIT
cd $tmpdir

git clone git@github.com:fsareshwala/$repo.git
cd $repo || log_error "directory $repo does not exist"

git remote set-url origin git@github.com:$username/$repo.git
git push -uf origin master
